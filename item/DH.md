**Diffie-Hellman 키 교환(DH, Diffie-Hellman key exchange)**

## 📖 개념과 원리

**DH 키 교환**은 두 사람이 안전하지 않은 통신 채널에서도 **공통 비밀키**를 만들 수 있게 해주는 암호화 프로토콜입니다.

### 🔑 핵심 아이디어

1. **공개 정보**: 모든 사람이 알 수 있는 값 (p, g)
2. **개인 비밀**: 각자만 아는 비밀 숫자 (a, b)
3. **수학적 마법**: 개인 비밀로 공개키를 만들어 교환하고, 최종적으로 같은 공유 비밀키를 얻음

### 🛡️ 보안의 핵심: 이산 로그 문제

- **쉬운 계산**: $g^x \mod p$ 계산하기
- **어려운 계산**: $g^x \equiv y \mod p$에서 $x$ 찾기 (이산 로그)

공격자가 $g$, $p$, $g^a \mod p$를 알아도 $a$를 찾기는 매우 어렵습니다!

### 🔄 DH 과정

1. **공개 파라미터 공유**: Alice와 Bob이 $p$, $g$ 합의
2. **개인키 생성**: Alice는 $a$, Bob은 $b$ (비밀)
3. **공개키 계산 및 교환**:
   - Alice: $A = g^a \mod p$ 계산 후 Bob에게 전송
   - Bob: $B = g^b \mod p$ 계산 후 Alice에게 전송
4. **공유 비밀키 생성**:
   - Alice: $s = B^a \mod p$ 계산
   - Bob: $s = A^b \mod p$ 계산
   - 결과: $s = g^{ab} \mod p$ (둘 다 같은 값!)

---

## 🧮 실제 계산 예제

주어진 값:

- $p = 29$ (소수, 모듈러 연산의 기준)
- $g = 5$ (생성기, generator)
- $b = 17$ (Bob의 비밀 키)

DH에서 공개키 $B$는 **다음 공식**으로 계산합니다:

$$
B \equiv g^b \mod p
$$

즉:

$$
B \equiv 5^{17} \mod 29
$$

---

### 1. 지수 나누어서 계산 (제곱과 곱셈 방법)

효율적으로 계산하기 위해 \*\*제곱과 곱셈 방법(Exponentiation by Squaring)\*\*을 쓰겠습니다.

1. $5^1 \equiv 5 \mod 29$
2. $5^2 \equiv 5 \cdot 5 = 25 \mod 29$
3. $5^4 \equiv 25^2 = 625 \equiv ? \mod 29$

계산:

$$
625 ÷ 29 = 21 \text{ 나머지 } 16
$$

→ $5^4 \equiv 16 \mod 29$

4. $5^8 \equiv 16^2 = 256 \mod 29$

$$
256 ÷ 29 = 8 × 29 = 232, 나머지 24
$$

→ $5^8 \equiv 24 \mod 29$

5. $5^{16} \equiv 24^2 = 576 \mod 29$

$$
576 ÷ 29 = 19 × 29 = 551, 나머지 25
$$

→ $5^{16} \equiv 25 \mod 29$

---

### 2. 최종 계산 $5^{17}$

$$
5^{17} = 5^{16} \cdot 5^1 \equiv 25 \cdot 5 = 125 \mod 29
$$

$$
125 ÷ 29 = 4 × 29 = 116, 나머지 9
$$

✅ 따라서 $B \equiv 9 \mod 29$

---

**결론:**

$$
\boxed{B = 9}
$$

---

## 🔍 실전에서의 활용

### CTF/해킹에서 DH 공격 포인트:

1. **약한 파라미터**: 작은 소수 $p$ 사용 시 brute force 가능
2. **생성기 문제**: $g$가 적절하지 않으면 일부 키만 생성됨
3. **중간자 공격**: 키 교환 과정에서 인증 없이 진행하면 위험
4. **사이드 채널**: 계산 시간이나 전력 소모로 비밀키 유추

### 방어 방법:

- **충분히 큰 소수** 사용 (최소 2048비트)
- **안전한 생성기** 선택
- **키 교환 인증** (디지털 서명 등)
- **Perfect Forward Secrecy** 구현

---

## 💡 왜 이걸 알아야 할까?

DH는 현대 암호화의 기초입니다:

- **HTTPS/TLS**: 웹사이트 보안 연결
- **VPN**: 안전한 터널링
- **SSH**: 원격 서버 접속
- **블록체인**: 디지털 서명과 지갑

CTF에서는 DH 파라미터 분석, 약한 키 찾기, 중간자 공격 시뮬레이션 등이 자주 출제됩니다!
